# 실전 데이터 분석

## 실전 데이터 분석 예시
- 지역별 국내 휴양림 분포 (빈도분석)
- 해외 입국자 추이 확인
- 코로나 선별진료소 지도 시각화
- 서울시 지역별 미세먼지 농도


## 지역별 국내 휴양림 분포
1. 데이터 수집
    - 전국 휴양림 데이터 다운로드
    - https://www.data.go.kr
    - "전국휴양림표준데이터" 검색
    - [표준데이터셋] > "전국휴양림표준데이터"
    - [그리드] > [XLS]

2. 데이터 가공
    - 전처리
    * 데이터 항목 확인 : 휴양림명, 시도명, 휴양림구분, 휴양림면적, 수용인원수, 입장료, 숙박가능여부, 주요시설명 등
    * 비어있는 1행 삭제

    * 필요한 항목 : 휴양림명, 시도명, 휴양림구분, 휴양림면적, 수용인원수, 소재지도로명주소, 제공기관코드, 제공기관명

    * 불필요한 항목 : 입장료, 주요시설명, 관리기관명, 휴양림전화번호, 홈페이지주소, 위도, 경도, 데이터기준일

    * 새로운 항목 : "소재지도로명주소" 항목을 시와 도로 분리
        - [데이터] > [텍스트 나누기] > [구분 기호로 분리됨] > [탭, 공백] 
        - "기존 데이터를 바꾸시겠습니까?" > [확인]
        - "소재지도로명주소" → "소재지_시도명" 으로 항목명 변경
        - 시도명 아래 항목 열들은 삭제

    * 데이터 유형 변경
        - "휴양림면적", "수용인원수" : "문자형" → "숫자" 변환

    * 엑셀파일 저장 : "forest.xls"


3. 데이터 분석
    - 빈도 분석
    - 시각화

```
    # 엑셀 파일 가져오기
    install.packages("readxl")
    library(readxl)
    path <- "C:/KHM/R/code/source/"
    file <- paste0( path, "forest.xls")
    forest_data <- read_excel( file )

    # 변수명 변경
    colnames(forest_data) <- c("name", "city", "gubun", "area", "number", "stay", "city_new", "code", "codename")

    # 데이터 구조 및 앞부분 확인
    str(forest_data)
    head(forest_data)

```

``` # 시도별 휴양림 빈도분석 - freq() 함수
   library(descr)
   freq(forest_data$city, plot = T, main = 'city')
```


``` # 시도별 휴양림 빈도분석 - table() 함수
   city_table <- table(forest_data$city)
   city_table
   barplot(city_table)
```

```# 시도별 휴양림 수 구하고 내림차순 정렬하기
   library(dplyr)
   count(forest_data, city) %>% arrange(desc(n))

   # - count(forest_data, city) 
   # : 휴양림 데이터세트의 시도별 개수 → 데이터 프레임(city, n)

   # - %>% arrange( desc(n) )  
   # : 앞에서 구한 데이터 프레임의 n(개수) 기준으로 desc() 함수로 내림차순 정렬

   # 파이프 연산자 미사용
   x <- count(forest_data, city) 
   arrange( x, desc(n) )
```
    - count(forest_data, city) : 휴양림 데이터세트의 시도별 개수 → 데이터 프레임(city, n)
    - %>% arrange( desc(n) )   : 앞에서 구한 데이터 프레임의 n(개수)을 기준으로 desc() 함수로 내림차순 정렬


``` # 시도별, 소재지_시도명, 제공기관명 별로 분포 확인하기
   library(dplyr)
   count(forest_data, city) %>% arrange(desc(n))
   count(forest_data, city_new) %>% arrange(desc(n))
   count(forest_data, codename) %>% arrange(desc(n))
```


## 해외 입국자 추이 확인
1. 데이터 수집
    - 투어고 홈페이지
    - http://know.tour.go.kr
    - "2020년 입국자 수" 데이터 조회
    - [통계] > [관광객통계] > [입국관광통계]
    - 검색 조건
        - 통계유형 : 국적별 입국
        - 기간구분 : 2020년 01월 ~ 2020년 12월
    - [엑셀 내려받기] > [셀 병합 유지]


2. 데이터 가공
    1. 엑셀로 전처리
    - "국적별" 셀 [셀 병합 해제] > 2행 삭제
    - 삭제할 열 "계"
    - 삭제할 행 : (연두색 배경의 행) 아시아주, 중동, 미주, 구주, 대양주, 아프리카주, 기타, 전체
    - 엑셀 파일 저장 : entrance.xls

    2. 데이터 재구조화
    ```
    # 엑셀 파일 가져오기
    install.packages("readxl")
    library(readxl)
    path <- "C:/KHM/R/code/source/"
    file <- paste0( path, "entrance.xls")
    entrance_data <- read_excel( file )

    ```

    # 데이터 구조 및 앞부분 확인
    str(entrance_data)
    head(entrance_data)

    # 변수명 영어로 변경
    colnames(entrance_data) <- c("country", "JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC")

    # 국가명 띄어쓰기 제거
    entrance_data$country <- gsub(" ", "", entrance_data$country)
    head(entrance_data)
    ```

    ``` 
    # 국가 개수 확인
    entrance_data |> nrow()

    # 1월기준 상위 5개국 추출하기
    # order(-entrance_data$JAN) : 1월 기준 내림차순
    # |> head(n = 5)  :1월 기준 내림차순한 데이터의 상위 5개
    top5_country <- entrance_data[order(-entrance_data$JAN),] |> head(n = 5)
    top5_country

    ```

    ```
    # 데이터 구조 재구조화하기
    # - 열로 나열된 월별 데이터(JAN, FEB, ..)를 행으로 변환
    install.packages("reshape2")
    library(reshape2)
    top5_melt <- melt(top5_country, id.vars='country', variable.name = 'mon')
    head(top5_melt)

3. 데이터 분석
- 2020년 월별 입국자 수 
  - 데이터 변화 추이             : 선 그래프
  - 상위 5개국 국가별 변화 추이  : 막대그래프, 누적 막대 그래프
  
``` # 2020년 월별 입국자 수 - 선 그래프
   install.packages("ggplot2")
   library(ggplot2)
   ggplot(top5_melt, aes(x = mon, y = value, group = country)) + 
      geom_line(aes(color = country)) +
      ggtitle("2020년 국적별 입국자 수 변화 추이") +
      scale_y_continuous(breaks = seq(0, 500000, 50000))
```

``` # 2020년 월별 입국자 수 - 막대 그래프
   install.packages("ggplot2")
   library(ggplot2)
   ggplot(top5_melt, aes(x = mon, y = value, fill = country)) + 
      geom_bar(stat = "identity", position = "dodge") +
      ggtitle("2020년 국적별 입국자 수 변화 추이") +
      scale_y_continuous(breaks = seq(0, 50000, 50000))
```

``` # 2020년 월별 입국자 수 - 누적 그래프
   install.packages("ggplot2")
   library(ggplot2)
   ggplot(top5_melt, aes(x = mon, y = value, fill = country)) + 
      geom_bar(stat = "identity", position = "stack") +
      ggtitle("2020년 국적별 입국자 수 변화 추이") +
      scale_y_continuous(breaks = seq(0, 50000, 50000))
```
- 2020년 월별 입국자 수 
  - 데이터 변화 추이             : 선 그래프
  - 상위 5개국 국가별 변화 추이  : 막대그래프, 누적 막대 그래프
  
``` # 2020년 월별 입국자 수 - 선 그래프
   install.packages("ggplot2")
   library(ggplot2)
   ggplot(top5_melt, aes(x = mon, y = value, group = country)) + 
      geom_line(aes(color = country)) +
      ggtitle("2020년 국적별 입국자 수 변화 추이") +
      scale_y_continuous(breaks = seq(0, 500000, 50000))
```

``` # 2020년 월별 입국자 수 - 막대 그래프
   install.packages("ggplot2")
   library(ggplot2)
   ggplot(top5_melt, aes(x = mon, y = value, fill = country)) + 
      geom_bar(stat = "identity", position = "dodge") +
      ggtitle("2020년 국적별 입국자 수 변화 추이") +
      scale_y_continuous(breaks = seq(0, 50000, 50000))
```

``` # 2020년 월별 입국자 수 - 누적 그래프
   install.packages("ggplot2")
   library(ggplot2)
   ggplot(top5_melt, aes(x = mon, y = value, fill = country)) + 
      geom_bar(stat = "identity", position = "stack") +
      ggtitle("2020년 국적별 입국자 수 변화 추이") +
      scale_y_continuous(breaks = seq(0, 50000, 50000))
```

## 코로나 선별진료소 지도 시각화하기
1. 데이터 수집
    - 공공데이터 포털
    - https://www.data.go.kr
    - "선별진료소 현황" 검색
    - [파일데이터] "보건복지부_코로나19_선별진료소_현황"
    - [URL] > [링크] > [엑셀파일 다운로드]
    - 엑셀 파일명 : 선별진료소_현황.xls

    
2. 데이터 가공
    - 엑셀 파일 가져오기
    - 필요한 컬럼만 추출하기

    
3. 데이터 분석
